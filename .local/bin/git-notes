#!/bin/bash

# Путь к директории с данными в обычном виде
source_dir="$HOME/Documents/notes"

# Путь к директории с зашифрованными данными
encrypted_dir="$HOME/Documents/encrypted_notes"

cp -r "$source_dir"/* "$encrypted_dir"

encrypt_files_recursive() {
    local source_dir="$1"
    local encrypted_dir="$2"
    find "$source_dir" -type d -print0 | while IFS= read -r -d '' dir; do
        rel_path="${dir#$source_dir}"
        mkdir -p "$encrypted_dir/$rel_path"
    done

    # Шифруем файлы
    find "$source_dir" -type f ! -name ".*" -print0 | while IFS= read -r -d '' file; do
        rel_path="${file#$source_dir}"
        if [[ $rel_path != .* ]]; then
            if [[ $file != *"/."* ]]; then
                gpg --output "$encrypted_dir/$rel_path.asc" --encrypt -a --recipient mail.sr.44@gmail.com --yes "$file"
            fi
        fi
    done

}


encrypt_files_recursive "$source_dir" "$encrypted_dir"
find "$encrypted_dir" -type f ! -name "*.asc" ! -path "$encrypted_dir/.git/*" -delete

cd "$encrypted_dir" && git add -A && git commit -am "Update encrypted data" && git push

